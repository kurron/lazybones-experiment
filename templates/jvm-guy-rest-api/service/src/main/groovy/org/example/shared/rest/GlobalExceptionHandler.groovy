package org.example.shared.rest

import org.example.rest.model.ErrorContext
import org.example.rest.model.SimpleMediaType
import org.example.shared.feedback.BaseFeedbackAware
import org.springframework.http.HttpStatus
import org.springframework.http.ResponseEntity
import org.springframework.web.bind.annotation.ControllerAdvice
import org.springframework.web.bind.annotation.ExceptionHandler

/**
 * Will handle all errors generated by controllers.
 */
@SuppressWarnings('GroovyUnusedDeclaration')
@ControllerAdvice
class GlobalExceptionHandler extends BaseFeedbackAware {

    @ExceptionHandler
    ResponseEntity<SimpleMediaType> handleResourceNotFound( ResourceNotFoundError context ) {
        feedbackProvider.sendFeedback( context.context, context.arguments )
        def error = new ErrorContext( title: context.title, code: context.code, message: context.message )
        def hypermediaControl = new SimpleMediaType( error: error )
        new ResponseEntity<SimpleMediaType>( hypermediaControl, HttpStatus.NOT_FOUND )
    }
}
